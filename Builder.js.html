<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Builder.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Builder.html">Builder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Builder.html#build">build</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Parser.html">Parser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Parser.html#parse">parse</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Builder.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/**
 * Builder for making BINVOX buffer data.
 */
export class Builder {

  /**
   * Creates a new BINVOX Builder.
   */
  constructor() {
    this.dimension = {};
    this.translation = {};
    this.scale = 1;
    this.voxels = [];
  }

  /**
   * Build BINVOX file buffer data.
   * @param {VoxelData} data JavaScript representation of BINVOX voxel data.
   */
  build(data) {
    this.dimension = data.dimension;
    this.translation = data.translate;
    this.scale = data.scale;
    this.voxels = data.voxels;

    let headerTArray = this._generateHeader();
    let voxelsTArray = this._generateVoxelData();

    // Concatenate the two typed arrays.
    var binvoxArray = new Uint8Array(headerTArray.length + voxelsTArray.length);
    binvoxArray.set(headerTArray);
    binvoxArray.set(voxelsTArray, headerTArray.length);

    return binvoxArray.buffer;
  }

  /**
   * Generate the ASCII BINVOX file header.
   * @private
   */
  _generateHeader() {
    var encoder = new TextEncoder('ascii');

    let header = "";
    header += "#binvox 1\n";
    header += "dim " + [this.dimension.depth, this.dimension.width, this.dimension.height].join(" ") + "\n";
    header += "translate " + [this.translation.depth, this.translation.width, this.translation.height].join(" ") + "\n";
    header += "scale " + this.scale + "\n";
    header += "data\n";

    return encoder.encode(header);
  }

  /**
   * Generate the binary voxel data.
   * @private
   */
  _generateVoxelData() {
    let index = 0;
    let count = 0;
    let state;
    if (
      this.voxels[0].x === 0 &amp;&amp;
      this.voxels[0].y === 0 &amp;&amp;
      this.voxels[0].z === 0
    ) {
      state = 1;
    } else {
      state = 0;
    }

    let array = [];

    for (let i = 0; i &lt; this.dimension.width; i++) {
      for (let j = 0; j &lt; this.dimension.height; j++) {
        for (let k = 0; k &lt; this.dimension.depth; k++) {

          let value = 0;
          if (
            this.voxels[index] !== undefined &amp;&amp;
            // TODO check indexes...
            this.voxels[index].x === i &amp;&amp;
            this.voxels[index].y === k &amp;&amp;
            this.voxels[index].z === j
          ) {
            index++;
            value = 1;
          }

          if (value === state) {
            count++;
            if (count === 255) {
              // Max count encountered!
              array.push(state, count);
              count = 0;
            }
          } else {
            // Switch in state detected!
            array.push(state, count);
            state = value;
            count = 1;
          }
        }
      }
    }
    // Handle remaining.
    if (count > 0) {
      array.push(state, count);
    }

    return new Uint8Array(array);
  }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Fri Apr 10 2020 14:34:20 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
